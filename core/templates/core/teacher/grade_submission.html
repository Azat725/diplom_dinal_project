{% extends 'core/base.html' %}
{% block content %}
<h3>Проверка: {{ submission.student.get_full_name }}</h3>
<p class="text-muted">Тест: {{ submission.quiz.title }}</p>

<form method="post">
    {% csrf_token %}
    
    {% for answer in submission.answers.all %}
    <div class="card mb-3">
        <div class="card-header">
            Вопрос: {{ answer.question.text }} 
            (Макс: {{ answer.question.score }})
        </div>
        <div class="card-body">
            {% if answer.question.question_type == 'IMAGE_UPLOAD' %}
                {% if answer.image_response %}
                    <img src="{{ answer.image_response.url }}" class="img-fluid rounded mb-2" style="max-height: 400px;">
                    <p><a href="{{ answer.image_response.url }}" target="_blank">Открыть оригинал</a></p>
                {% else %}
                    <p class="text-danger">Файл не загружен</p>
                {% endif %}
            
            {% elif answer.question.question_type == 'TEXT' %}
                <p><strong>Ответ студента:</strong> {{ answer.text_response }}</p>
                <p class="text-success small">Правильный: {{ answer.question.correct_text.first.text_answer }}</p>
            
            {% else %}
                <ul>
                {% for opt in answer.selected_options.all %}
                    <li>{{ opt.text }} {% if opt.is_correct %}(Верно){% endif %}</li>
                {% endfor %}
                </ul>
            {% endif %}

            <div class="mt-3">
                <label>Оценка за этот вопрос:</label>
                <input type="number" step="0.1" name="score_{{ answer.id }}" 
                       value="{{ answer.score|floatformat }}" 
                       class="form-control" style="width: 100px;">
            </div>
        </div>
    </div>
    {% endfor %}

    <button type="submit" class="btn btn-success btn-lg w-100 mb-5">Сохранить оценки</button>
</form>
{% endblock %}